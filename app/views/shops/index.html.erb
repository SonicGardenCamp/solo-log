<h2>googlemap</h2>
<div id='map'></div>

<style>
#map {
  height: 400px;
  width: 600px;
}
</style>

<script>
let map;

const shops = [
  <% @shops.each do |shop| %>
    {
      lat: <%= shop.latitude %>,
      lng: <%= shop.longitude %>
    },
  <% end %>
];

function initMap(){
  geocoder = new google.maps.Geocoder()

  map = new google.maps.Map(document.getElementById('map'), {
    center: {lat: 38, lng: 139.5},
    zoom: 4,
  });

  shops.forEach(shop=> {
    marker = new google.maps.Marker({
      position:  {lat: shop.lat , lng: shop.lng},
      map: map
    });
  });
}

</script>
<script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_MAP_API_KEY'] %>&callback=initMap" async defer></script>

<% if false %>
  <%= stylesheet_link_tag 'index' %>

  <h1>All shops</h1>
  
  <h2>検索条件</h2>
  <%= search_form_for @q, url: shops_path do |f| %>
    <%= f.label :name, 'お店の名前' %>
    <%= f.search_field :name_cont %>
    <%= f.submit '検索' %>
  <% end %>
  <%#= form_with model: @q, url: shops_path, method: :get do |f| %>
    <%#= f.label :name, 'お店の名前' %>
    <%#= f.search_field :name_cont %>
    <%#= f.submit '検索' %>
  <%# end %>
  <div class="container">
    <div class="row row-eq-height" >
      <% @shops.each_with_index do |shop, index| %>
        <div class="col-md-3 mb-4">
          <div class="card" style="width: 16rem; height: 20rem">
            <%= link_to shop_path(shop) , class:"card-body text-dark" do %>
              <!-- 仮の画像を表示 -->
              <% if index % 3 == 0 %>
                <img src="https://rocketnews24.com/wp-content/uploads/sites/2/2020/04/hsawayaka1.jpg?resize=1536,1279" class="card-img-top" alt="<%= shop.name %>" height="200">
              <% elsif index % 3 == 1 %>
                <img src="https://www.inapymes.com/wp-content/uploads/2023/03/20220812-hikakin-99.jpg" class="card-img-top" alt="<%= shop.name %>" height="200">
              <% else %>
                <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQPDEdijzxxcbuaN2tc6--TK0w3ms2ASw5hYA&usqp=CAU" class="card-img-top" alt="<%= shop.name %>" height="200">
              <% end %>
              <!-- ↑仮の画像を表示 -->
              <div class="card-body">
                <h5 class="card-title"><%= shop.name %></h5>
                <p class="card-text"><%= shop.address %></p>
              </div>
            <% end %>
          </div>
        </div>
        <% if (index + 1) % 4 == 0 %>
          </div>
          <div class="row">
        <% end %>
      <% end %>
    </div>
  </div>
<% end %>